<Window x:Class="VlcScriptPlayer.UI.MainWindow"
        x:ClassModifier="internal"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:handy="clr-namespace:VlcScriptPlayer.Handy"
        xmlns:ui="clr-namespace:VlcScriptPlayer.UI"
        xmlns:commonui="clr-namespace:ZemotoCommon.UI"
        mc:Ignorable="d"
        Title="VLC Script Player"
        SizeToContent="WidthAndHeight"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        d:DataContext="{d:DesignInstance Type={x:Type ui:MainWindowViewModel}, IsDesignTimeCreatable=True}">
   <Window.Resources>
      <commonui:BoolToObjectConverter x:Key="ConnectedTextColorConverter"
                                      TrueValue="Green"
                                      FalseValue="Red" />

      <commonui:EqualityConverter x:Key="InequalityConverter"
                                  Invert="True" />

      <Style TargetType="{x:Type Button}">
         <Setter Property="Height"
                 Value="24" />
         <Setter Property="Padding"
                 Value="6,0" />
      </Style>

      <Style TargetType="{x:Type TextBox}">
         <Setter Property="Height"
                 Value="24" />
      </Style>

   </Window.Resources>
   <Grid>
      <Grid.RowDefinitions>
         <RowDefinition Height="Auto" />
         <RowDefinition Height="Auto" />
         <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>
      <Grid.ColumnDefinitions>
         <ColumnDefinition Width="Auto" />
         <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <!--Settings-->
      <GroupBox Header="Settings"
                Width="250"
                Grid.Row="0"
                Grid.Column="0"
                Margin="8,4,2,4"
                IsEnabled="{Binding RequestInProgress, Mode=OneWay, Converter={x:Static commonui:InvertBoolConverter.Instance}}">
         <StackPanel Margin="4">
            <TextBlock FontWeight="SemiBold"
                       Text="{Binding Config.Handy.IsConnected, Mode=OneWay, StringFormat={}Connected: {0}}"
                       Foreground="{Binding Config.Handy.IsConnected, Mode=OneWay, Converter={StaticResource ConnectedTextColorConverter}}" />

            <Grid Margin="0,4,0,0">
               <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
               </Grid.ColumnDefinitions>

               <TextBox Grid.Column="0"
                        Text="{Binding Config.Handy.ConnectionId, Mode=TwoWay}"
                        VerticalContentAlignment="Center" />

               <Button Grid.Column="1"
                       Margin="4,0,0,0"
                       Content="Connect"
                       Command="{Binding ConnectCommand, Mode=OneTime}" />
            </Grid>

            <TextBlock Margin="0,4,0,0"
                       FontWeight="SemiBold"
                       Text="{Binding Config.Handy.CurrentOffset, Mode=OneWay, StringFormat={}Current Offset: {0}ms}" />

            <Grid Margin="0,4,0,0"
                  IsEnabled="{Binding Config.Handy.IsConnected, Mode=OneWay}">
               <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
               </Grid.ColumnDefinitions>
               <TextBox Grid.Column="0"
                        Text="{Binding Config.Handy.DesiredOffset, Mode=TwoWay}"
                        VerticalContentAlignment="Center" />

               <Button Grid.Column="1"
                       Margin="4,0,0,0"
                       Content="Set Offset"
                       Command="{Binding SetOffsetCommand, Mode=OneTime}" />
            </Grid>

            <TextBlock Margin="0,4,0,0"
                       FontWeight="SemiBold">
               <Run Text="Current Slide Range:" /> <Run Text="{Binding Config.Handy.CurrentSlideMin, Mode=OneWay, StringFormat=N2}" />% - <Run Text="{Binding Config.Handy.CurrentSlideMax, Mode=OneWay, StringFormat=N2}" />%
            </TextBlock>

            <Grid Margin="0,4,0,0"
                  IsEnabled="{Binding Config.Handy.IsConnected, Mode=OneWay}">
               <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
               </Grid.ColumnDefinitions>
               <TextBox Grid.Column="0"
                        Text="{commonui:DoubleMinMaxBinding Config.Handy.DesiredSlideMin, 0, 90, Mode=TwoWay, StringFormat=N2}"
                        VerticalContentAlignment="Center" />

               <Rectangle Grid.Column="1"
                          Fill="Gray"
                          Margin="4,0"
                          Height="1"
                          Width="4"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center" />

               <TextBox Grid.Column="2"
                        Text="{commonui:DoubleMinMaxBinding Config.Handy.DesiredSlideMax, 10, 100, Mode=TwoWay, StringFormat=N2}"
                        VerticalContentAlignment="Center" />

               <Button Grid.Column="3"
                       Margin="4,0,0,0"
                       Content="Set Range"
                       Command="{Binding SetRangeCommand, Mode=OneTime}" />
            </Grid>

            <CheckBox Margin="0,8,0,0"
                      Content="Boost Bass"
                      IsChecked="{Binding Config.Filters.BoostBass, Mode=TwoWay}" />

            <CheckBox Margin="0,8,0,0"
                      Content="Boost Saturation"
                      IsChecked="{Binding Config.Filters.BoostSaturation, Mode=TwoWay}" />
         </StackPanel>
      </GroupBox>

      <!--Video/Script-->
      <GroupBox Header="Video/Script"
                Width="340"
                Grid.Row="0"
                Grid.Column="1"
                Margin="2,4,8,4">
         <Grid Margin="4">
            <Grid.RowDefinitions>
               <RowDefinition Height="Auto" />
               <RowDefinition Height="Auto" />
               <RowDefinition Height="4" />
               <RowDefinition Height="Auto" />
               <RowDefinition Height="Auto" />
               <RowDefinition Height="4" />
               <RowDefinition Height="Auto" />
               <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
               <ColumnDefinition Width="*" />
               <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Row="0"
                       Grid.Column="0"
                       HorizontalAlignment="Left"
                       Text="Video"
                       FontWeight="SemiBold"
                       Margin="0,0,0,2" />

            <TextBox Grid.Row="1"
                     Grid.Column="0"
                     IsReadOnly="True"
                     Text="{Binding Config.VideoFilePath, Mode=OneWay}"
                     VerticalContentAlignment="Center" />

            <Button Grid.Row="1"
                    Grid.Column="1"
                    Margin="4,0,0,0"
                    Content="Select"
                    Command="{Binding SelectVideoCommand, Mode=OneTime}" />

            <TextBlock Grid.Row="3"
                       Grid.Column="0"
                       HorizontalAlignment="Left"
                       Text="Script"
                       FontWeight="SemiBold"
                       Margin="0,0,0,2" />

            <TextBox Grid.Row="4"
                     Grid.Column="0"
                     IsReadOnly="True"
                     Text="{Binding Config.ScriptFilePath, Mode=OneWay}"
                     VerticalContentAlignment="Center" />

            <Button Grid.Row="4"
                    Grid.Column="1"
                    Margin="4,0,0,0"
                    Content="Select"
                    Command="{Binding SelectScriptCommand, Mode=OneTime}" />

            <TextBlock Grid.Row="6"
                       Grid.Column="0"
                       HorizontalAlignment="Left"
                       Text="Script Folder"
                       FontWeight="SemiBold"
                       Margin="0,0,0,2" />

            <TextBox Grid.Row="7"
                     Grid.Column="0"
                     IsReadOnly="True"
                     Text="{Binding Config.ScriptFolder, Mode=OneWay}"
                     VerticalContentAlignment="Center" />

            <Button Grid.Row="7"
                    Grid.Column="1"
                    Margin="4,0,0,0"
                    Content="Select"
                    Command="{Binding SelectScriptFolderCommand, Mode=OneTime}" />
         </Grid>

      </GroupBox>

      <Grid Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="99"
            Margin="8,0">
         <Grid.IsEnabled>
            <MultiBinding Converter="{x:Static commonui:MultiBoolToBoolAndConverter.Instance}">
               <MultiBinding.Bindings>
                  <Binding Path="Config.VideoFilePath.Length"
                           Converter="{StaticResource InequalityConverter}"
                           ConverterParameter="0"
                           Mode="OneWay" />
                  <Binding Path="Config.ScriptFilePath.Length"
                           Converter="{StaticResource InequalityConverter}"
                           ConverterParameter="0"
                           Mode="OneWay" />
                  <Binding Path="Config.Handy.IsConnected"
                           Mode="OneWay" />
               </MultiBinding.Bindings>
            </MultiBinding>
         </Grid.IsEnabled>
         <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="4" />
            <ColumnDefinition Width="Auto" />
         </Grid.ColumnDefinitions>
         
         <Button Grid.Column="0" 
                 Content="Upload Script and Launch Player"
                 Command="{Binding UploadScriptAndLaunchPlayerCommand, Mode=OneTime}"
                 CommandParameter="False" />

         <Button Grid.Column="2"
                 Content="Force Upload"
                 Command="{Binding UploadScriptAndLaunchPlayerCommand, Mode=OneTime}"
                 CommandParameter="True"/>
      </Grid>

      <TextBox x:Name="LogTextBox"
               Grid.Row="2"
               Grid.Column="0"
               Grid.ColumnSpan="99"
               Height="100"
               Padding="4"
               Margin="8,4,8,8"
               TextChanged="OnLogTextChanged"
               Text="{Binding Source={x:Static handy:HandyLogger.Instance}, Path=LogData, Mode=OneWay}"
               FontFamily="Consolas"
               FontSize="12"
               IsReadOnly="True"
               VerticalScrollBarVisibility="Auto"
               HorizontalScrollBarVisibility="Disabled"
               TextWrapping="Wrap" />
   </Grid>
</Window>
